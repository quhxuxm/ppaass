#[cfg(test)]
mod testing {
    use std::net::ToSocketAddrs;

    use bytes::{Buf, Bytes};

    use common::{
        decrypt_with_aes, decrypt_with_blowfish, encrypt_with_aes, encrypt_with_blowfish, generate_uuid, AgentMessagePayloadTypeValue, Message, MessagePayload,
        NetAddress, PpaassError, ProxyMessagePayloadTypeValue, RsaCrypto,
    };

    #[test]
    fn test_format_message_payload_to_json() -> Result<(), PpaassError> {
        let message_payload = MessagePayload {
            source_address: Some(NetAddress::IpV4 { host: [1, 1, 1, 1], port: 10 }),
            target_address: Some(NetAddress::IpV4 { host: [2, 2, 2, 2], port: 20 }),
            payload_type: common::PayloadType::AgentPayload(AgentMessagePayloadTypeValue::TcpConnect),
            data: Some(vec![0, 1, 2, 3, 4, 5]),
        };
        println!("{}", serde_json::to_string(&message_payload).map_err(|e| PpaassError::CodecError)?);
        let message_payload = MessagePayload {
            source_address: Some(NetAddress::IpV4 { host: [1, 1, 1, 1], port: 10 }),
            target_address: Some(NetAddress::IpV4 { host: [2, 2, 2, 2], port: 20 }),
            payload_type: common::PayloadType::ProxyPayload(ProxyMessagePayloadTypeValue::TcpConnectSuccess),
            data: Some(vec![0, 1, 2, 3, 4, 5]),
        };
        println!("{}", serde_json::to_string(&message_payload).map_err(|e| PpaassError::CodecError)?);
        Ok(())
    }

    #[test]
    fn test_format_message_to_json() -> Result<(), PpaassError> {
        let message = Message {
            id: "id".to_string(),
            connection_id: Some("connectionId".to_string()),
            ref_id: Some("refId".to_string()),
            user_token: "userToken".to_string(),
            payload_encryption: common::PayloadEncryption::Aes(vec![0, 1, 2, 3, 4]),
            payload: Some(vec![0, 1, 2, 3, 4, 5]),
        };
        println!("{}", serde_json::to_string(&message).map_err(|e| PpaassError::CodecError)?);
        let message = Message {
            id: "id".to_string(),
            connection_id: Some("connectionId".to_string()),
            ref_id: Some("refId".to_string()),
            user_token: "userToken".to_string(),
            payload_encryption: common::PayloadEncryption::Plain,
            payload: Some(vec![0, 1, 2, 3, 4, 5]),
        };
        println!("{}", serde_json::to_string(&message).map_err(|e| PpaassError::CodecError)?);
        Ok(())
    }
    #[test]
    fn test4() -> Result<(), PpaassError> {
        let socket_addrs = "incoming.telemetry.mozilla.org:80".to_socket_addrs()?;
        socket_addrs.for_each(|item| println!("Socket addr: {item:?}"));
        Ok(())
    }
    #[test]
    fn test1() -> Result<(), PpaassError> {
        let uid = generate_uuid();
        let key = uid.as_bytes();
        // let mut plaintext = *b"hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111sddhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111sddhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111sddhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111sddhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111sddhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111sddhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111sddhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111sddhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111sddhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111sddhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111sddhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111sddhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111sddhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111sddhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111sddhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111sddhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111sddhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111sddhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111sddhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111sddhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111sddhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111sddhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111sddhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111sddhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111sddhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111sdd";
        let mut plaintext = *b"";
        let mut encrypt_result = encrypt_with_aes(&key, &plaintext);
        println!("{:?}", encrypt_result);
        let decrypt_result = decrypt_with_aes(&key, encrypt_result.as_mut_slice());
        println!("{:?}", plaintext);
        println!("{:?}", decrypt_result);
        Ok(())
    }
    #[test]
    fn test2() -> Result<(), PpaassError> {
        let uid = b"0123456789abcdef0123456789abcdef";
        let key = uid;
        let mut plaintext = *b"hello world11111hello world11111hello world11111hello world11111hello world11111hello world11111helhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111helhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111helhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111helhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111helhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111helhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111helhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111helhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111helhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111helhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111helhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111helhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111helhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111helhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111helhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111helhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111helhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111helhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111helhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111helhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111helhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111helhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111helhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111helhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111helhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111helhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111helhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111helhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111helhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111helhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111helhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111helhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111helhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111helhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111helhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111helhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111helhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111helhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111helhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111helhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111helhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111helhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111helhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111helhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111helhello world11111hello world11111hello world11111hello world11111hello world11111hello world11111hel";
        //let mut plaintext = *b"";
        let mut encrypt_result = encrypt_with_blowfish(key, &plaintext);
        println!("{:?}", encrypt_result);
        let decrypt_result = decrypt_with_blowfish(key, encrypt_result.as_mut_slice());
        println!("{:?}", plaintext);
        println!("{:?}", decrypt_result);
        Ok(())
    }

    #[test]
    fn test3() -> Result<(), PpaassError> {
        let rsa_token = "0123456789abcedf0123456789abcedf";
        let public_key = std::fs::read_to_string("D:\\Git\\ppaass\\rsa\\user1\\AgentPublicKey.pem")?;
        let private_key = std::fs::read_to_string("D:\\Git\\ppaass\\rsa\\user1\\ProxyPrivateKey.pem")?;
        let rsa_crypto = RsaCrypto::new(public_key, private_key)?;
        let rsa_token_bytes = Bytes::from(rsa_token);
        let rsa_encrypted_token = rsa_crypto.encrypt(&rsa_token_bytes)?;
        std::fs::write("D:\\rsa", rsa_encrypted_token.to_vec());
        println!("RSA encrypted token: {:?}", rsa_encrypted_token.to_vec());
        let aes_encrypt_target = "hello, i am quhaohello, i am quhaohello, i am quhaohello, i am quhaohello, i am quhaohello, i am quhaohello, i am quhaohello, i am quhaohello, i am quhaohello, i am quhaohello, i am quhaohello, i am quhaohello, i am quhaohello, i am quhaohello, i am quhaohello, i am quhaohello, i am quhaohello, i am quhaohello, i am quhaohello, i am quhaohello, i am quhaohello, i am quhaohello, i am quhaohello, i am quhaohello, i am quhaohello, i am quhaohello, i am quhaohello, i am quhaohello, i am quhaohello, i am quhaohello, i am quhaohello, i am quhaohello, i am quhao";
        let aes_encrypt_result = encrypt_with_aes(rsa_token_bytes.chunk(), aes_encrypt_target.as_bytes());
        std::fs::write("D:\\aes", aes_encrypt_result.to_vec());
        println!("AES encrypted result: {:?}", aes_encrypt_result.to_vec());

        Ok(())
    }
}
